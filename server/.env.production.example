# ============================================================================
# CodeRunner Server - Production Environment Configuration
# ============================================================================
# Copy this file to .env for production deployment

# === Server Configuration ===
NODE_ENV=production
PORT=3000
HOST=0.0.0.0
LOG_LEVEL=info
LOG_FORMAT=json

# === Docker Resource Configuration ===
# Standard container resource limits
DOCKER_MEMORY=512m
DOCKER_CPUS=0.5

# SQL/Notebook-specific resources (require more resources)
DOCKER_MEMORY_SQL=512m
DOCKER_CPUS_NOTEBOOK=1

# Docker command timeout (milliseconds)
DOCKER_CMD_TIMEOUT=15000

# Process execution timeout (used in code execution)
DOCKER_TIMEOUT=30s

# === Network Configuration ===
# Session network prefix for Docker networks
NETWORK_PREFIX=coderunner-session-

# === Session Container Management ===
# Container TTL before automatic cleanup (milliseconds)
SESSION_TTL=30000

# Cleanup check interval (milliseconds)
CLEANUP_INTERVAL=30000

# Orphaned network age threshold (milliseconds)
ORPHANED_NETWORK_AGE=300000

# Maximum containers per session (warning threshold)
MAX_CONTAINERS_PER_SESSION=10

# Enable/disable automatic cleanup
AUTO_CLEANUP=true

# Pre-warm container pool (experimental)
PREWARM_POOL=false

# === Execution Queue Configuration ===
# Maximum concurrent execution sessions (parallel code runs)
MAX_CONCURRENT_SESSIONS=50

# Maximum queue size (reject requests if exceeded)
MAX_QUEUE_SIZE=200

# Queue timeout - reject queued tasks after this duration (milliseconds)
QUEUE_TIMEOUT=60000

# Enable priority queue (higher priority for WebSocket vs API requests)
ENABLE_PRIORITY_QUEUE=true

# === Worker Thread Pool (Experimental) ===
# Number of worker threads for parallel Docker operations (0 = disabled)
WORKER_THREADS=4

# Enable worker pool for concurrent execution (experimental)
ENABLE_WORKER_POOL=true

# === Runtime Images ===
# Docker image names for each supported language
PYTHON_RUNTIME_IMAGE=python-runtime
CPP_RUNTIME_IMAGE=cpp-runtime
JAVASCRIPT_RUNTIME_IMAGE=javascript-runtime
JAVA_RUNTIME_IMAGE=java-runtime
MYSQL_RUNTIME_IMAGE=mysql-runtime

# === File Management ===
TEMP_DIR=/tmp
MAX_FILE_SIZE=10485760
MAX_FILES_PER_SESSION=50

# === Logging ===
REQUEST_LOGGING=true

# ============================================================================
# Docker Daemon Configuration
# ============================================================================
# Ensure /etc/docker/daemon.json contains:
# 
# {
#   "default-address-pools": [
#     {
#       "base": "172.80.0.0/12",
#       "size": 24
#     },
#     {
#       "base": "192.168.0.0/16",
#       "size": 24
#     }
#   ]
# }
#
# This configuration provides 4352 total /24 subnets for session networks
# Total Capacity: ~4352 concurrent sessions
# ============================================================================
